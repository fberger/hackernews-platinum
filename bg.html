    <html>
    <head>
    <script src="analytics.js"></script>
    <script>
trackPageView('/bg.html');

function toCode(f) {
    return "(" + f.toString() + ")();";
}

function installCloseHandler() {
    document.addEventListener('keydown', function (event) { 
	if(event.keyCode == 37 && (typeof(keysOn) === 'undefined' 
				   || keysOn === true)) {
	    chrome.extension.sendRequest({type: "track", 
					  data: ['_trackEvent', 'usage', 
						 'item', 'close-tab']});
	    self.close();
	}
    });
}

// Listen for any changes to the URL of any tab.
chrome.tabs.onUpdated.addListener(checkForValidUrl);

chrome.extension.onRequest.addListener(
    function(request, sender, sendResponse) {
	if (request.type == "openLink") {
	    chrome.tabs.create({
		"url":request.data.url,
		"selected":request.data.focus,
		"index":sender.tab.index
	    }, function (tab) {
		if (request.data.close == undefined || request.data.close) {
		    chrome.tabs.executeScript(tab.id, {
			code: toCode(installCloseHandler)
		    });
		}
	    });
	} else if (request.type == "track") {
	    console.log("track", request.data);
	    _gaq.push(request.data);
	}
    });

</script>
</head>
</html>
