<html>
<head>
<script src="analytics.js"></script>
<script>
    trackPageView('/bg.html');
  // Called when the url of a tab changes.
  function checkForValidUrl(tabId, changeInfo, tab) {
    if (tab.url.indexOf('http://news.ycombinator.com/') > -1) {
      chrome.pageAction.show(tabId);
    }
  };
  
  // Listen for any changes to the URL of any tab.
  chrome.tabs.onUpdated.addListener(checkForValidUrl);

  chrome.extension.onRequest.addListener(
    function(request, sender, sendResponse) {
	if (request.type == "openLink") {
	    chrome.tabs.create({
		"url":request.data.url,
		"selected":request.data.focus,
		"index":sender.tab.index
	    }, function (tab) {
		if (request.data.close == undefined || request.data.close) {
		    chrome.tabs.executeScript(tab.id, {
			code: "document.addEventListener('keydown', function (event) { if(event.keyCode == 37 && (typeof(keysOn) === 'undefined' || keysOn === true)) self.close(); });"
		    });
		}
	    });
	} else if (request.type == "track") {
	    _gaq.push(request.data);
	}
    });

</script>
</head>
</html>
